# README.md โ Jarvis Argus (ูุณุฎูู Chainlit โ ูุณุชูุฏุงุช ูพุฑูฺู)

**ูุงู ูพุฑูฺู:** Jarvis Argus โ Chat & Media Generator
**ูุงู ุงุตู ุงุฌุฑุง:** `app.py`
**ูุฏู:** ุงูพ ฺุช ูุจุชู ุจุฑ Chainlit ฺฉู ูพุงุณุฎโูุง ูุชู ุฑุง ุจุง Google Gemini ุจูโุตูุฑุช ุงุณุชุฑู ุชูฺฉู ููุงุด ูโุฏูุฏุ ุงุฒ MongoDB ุจุฑุง ุฐุฎุฑูโุณุงุฒ ุงุณุชูุงุฏู ูโฺฉูุฏุ ู ูพุดุชุจุงู ูพุงูโุง ุงุฒ ุขูพููุฏ ุชุตูุฑ ุฏุฑ ฺุช ุฏุงุฑุฏ.

---

## ๐ ูุฑูุฑ ฺฉูุชุงู (Overview)

Jarvis Argus ฺฉ ฺุชโุจุงุช ุณุฑูุฑโูุญูุฑ ุงุณุช ฺฉู:

* ุณุงุฎุชุงุฑ OOP ุจุง ฺฉูุงุณ `JarvisArgus` ุฏุงุฑุฏ.
* ุงุญุฑุงุฒ ููุช ุจุง `bcrypt` ู JWT ุงูุฌุงู ูโุดูุฏ.
* ฺฉุงุฑุจุฑุงูุ ูฺฉุงููุงุช ู ูพุงูโูุง ุฏุฑ MongoDB ุฐุฎุฑู ูโุดููุฏ (pymongo sync ุงูุง ูุฑุงุฎูุงูโูุง ุฏุงุฎู `asyncio.to_thread` ุงุฌุฑุง ูโุดููุฏ).
* ุงุณุชุฑู ูพุงุณุฎโูุง Google Gemini ุจู ุตูุฑุช incremental (producer ุฏุฑ thread โ `asyncio.Queue` โ consumer async) ูพุงุฏูโุณุงุฒ ุดุฏู ุงุณุช.
* ุงูฺฉุงู ุขูพููุฏ ุชุตูุฑ ุฏุฑ ูพุงู ูุฌูุฏ ุฏุงุฑุฏุ ุชุตูุฑ ุจู ุตูุฑุช ุงููู ุจู `data:` URI ุชุจุฏู ูโุดูุฏ (ูุงุจู ุงุฑุชูุง ุจู ุขูพููุฏ ุงุจุฑ).
* UI ุจุง Chainlit ุณุงุฎุชู ุดุฏู ู ูุงุจูุช ุงูุชุฎุงุจ ูุฏู ุชูุณุท ฺฉุงุฑุจุฑ ูุฑุงูู ุงุณุช.

---

## โจ ูุงุจูุชโูุง ุงุตู (Features)

* ุซุจุชโูุงู ู ูุฑูุฏ ฺฉุงุฑุจุฑุงู ุจุง JWT.
* ุงุฌุงุฏุ ุฐุฎุฑู ู ุจุงุฑฺฏุฐุงุฑ ูฺฉุงููุงุช (collection `conversations`).
* ุงุณุชุฑู ุฒูุฏูู ูพุงุณุฎโูุง ูุฏู (Gemini) ู ููุงุด ุชุฏุฑุฌ ุชูฺฉูโูุง ุฏุฑ UI.
* ูพุดุชุจุงู ูพุงูู ุงุฑุณุงู ุชุตูุฑ ุฏุฑ ูพุงูโูุง.
* ุงูุชุฎุงุจ ูุฏูโูุง ูุฎุชูู (MODELS ุจุง RPM/RPD ู ุชูุถุญุงุช).
* ูุญุฏูุฏุณุงุฒ ุณุฑุนุช ุงุฑุณุงู ูพุงู (rate-limit ุณุงุฏู).

---

## ๐ง ูพุดโูุงุฒูุง (Prerequisites)

* Python 3.10+ (ุชูุตู: 3.11 ุง 3.12)
* MongoDB (Atlas ุง ูุญู)
* ุฏุณุชุฑุณ ุจู ฺฉูุฏ Google Generative AI (ุฏุฑ ุตูุฑุช ุงุณุชูุงุฏู ุงุฒ Gemini)
* ูพฺฉุฌโูุง ููุฑุฏ ูุงุฒ (ููููู ุฏุฑ `requirements.txt` โ ุจุฎุด ูพุงู)

---

## ๐งพ ูุชุบุฑูุง ูุญุท ููุฑุฏ ูุงุฒ (Environment Variables)

ุฏุฑ ูุงู `.env` ุง ูุชุบุฑูุง ูุญุท ุณุณุชู ููุฏุงุฑูุง ุฒุฑ ุฑุง ูุฑุงุฑ ุฏูุฏ:

```env
MONGO_URI="mongodb+srv://<username>:<password>@cluster0.mongodb.net/jarvis_argus_db?retryWrites=true&w=majority"
GEMINI_API_KEY="sk-..."          # ุงุฎุชุงุฑ ูฺฏุฑ ุงูฺฉู ุงุฒ Gemini ุงุณุชูุงุฏู ฺฉูุฏ
JWT_SECRET_KEY="a-very-secret"   # ุถุฑูุฑ โ ุงุฒ ููุฏุงุฑ ูู ุงุณุชูุงุฏู ฺฉูุฏ
CHAINLIT_API_KEY=""              # ุงุฎุชุงุฑ
```

> **ูฺฉุชู ุงููุช:** ุจุฑุง production ุงุฒ Secret Manager ุณุฑูุณ ูุฒุจุงู ุงุณุชูุงุฏู ฺฉูุฏ ู `.env` ุฑุง ุฏุฑ ฺฏุช ูุฑุงุฑ ูุฏูุฏ.

---

## โถ๏ธ ูุตุจ ู ุงุฌุฑุง ูุญู (Run locally)

1. ูุตุจ ูุงุจุณุชฺฏโูุง:

```bash
pip install -r requirements.txt
```

2. ุชูุธู ูุชุบุฑูุง ูุญุท (ููููู ูููฺฉุณ/macOS):

```bash
export MONGO_URI="..."
export GEMINI_API_KEY="..."
export JWT_SECRET_KEY="..."
```

3. ุงุฌุฑุง:

```bash
# ูุงู ุงุตู ูพุฑูฺู: app.py
chainlit run app.py
# ุง ูุดุฎุต ฺฉุฑุฏู ูพูุฑุช:
chainlit run app.py --port 8000
```

ูพุณ ุงุฒ ุงุฌุฑุงุ ุขุฏุฑุณ ูุญู ุฏุฑ ุฎุฑูุฌ ููุงุด ุฏุงุฏู ูโุดูุฏ (ูุนูููุงู [http://localhost:8000](http://localhost:8000)).

---

## ๐งญ ูุญููู ุงุณุชูุงุฏู (Usage / Quick guide)

### ูุฑูุงูโูุง ุณุฑุน ุฏุงุฎู ฺุช (ูุชู)

ุฏุฑ ุญุงู ุญุงุถุฑ ุงุญุฑุงุฒ ููุช ู ูุฏุฑุช ูฺฉุงููุงุช ุงุฒ ุทุฑู ูุฑูุงูโูุง ูุชู ุงูุฌุงู ูโุดูุฏ:

* `/help` โ ููุงุด ููุฑุณุช ุฏุณุชูุฑุงุช
* `/signup <name> <email> <password>` โ ุซุจุชโูุงู
* `/login <email> <password>` โ ูุฑูุฏ
* `/new` โ ุดุฑูุน ูฺฉุงูููู ุฌุฏุฏ
* `/convs` โ ููุงุด ููุฑุณุช ูฺฉุงููุงุช ุดูุง
* `/select <conv_id>` โ ุงูุชุฎุงุจ ฺฉ ูฺฉุงููู ู ุจุงุฑฺฏุฐุงุฑ ูพุงูโูุง

### ุงูุชุฎุงุจ ูุฏู

ุฏุฑ ุดุฑูุน ฺุช ฺฉุงุฑุจุฑ ูโุชูุงูุฏ ุงุฒ ุทุฑู ChatSettings ฺฉ ูุฏู ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ (ููุงุฏุฑ ุงุฒ ูุชุบุฑ `MODELS` ุณุงุฎุชู ูโุดููุฏ). ุดูุงุณูู ูุฏู ุฏุฑ `cl.user_session["selected_model_id"]` ูุฑุงุฑ ูโฺฏุฑุฏ.

### ุขูพููุฏ ุชุตูุฑ

* ููุช ฺฉุงุฑุจุฑ ุชุตูุฑ ุงุฑุณุงู ูโฺฉูุฏุ ูุงู ุจุฑุฑุณ ู ุจู data URI ุชุจุฏู ูโุดูุฏ (`_image_element_to_data_uri`) ู ุจู ุชุงุฑุฎฺู ูพุงู ุงุถุงูู ูโฺฏุฑุฏุฏ.
* ุชูุตู: ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุบุฑุถุฑูุฑโุดุฏู ุญุฌู ุฏุชุงุจุณุ ุฏุฑ ูพุฑูฺูู ุจุนุฏ ุชุตุงูุฑ ุฑุง ุจู S3/GCS ุขูพููุฏ ฺฉูุฏ ู ููุท URL ุฑุง ุฐุฎุฑู ฺฉูุฏ.

---

## ๐๏ธ ูุนูุงุฑ ุฏุงุฎู (How it works)

1. ฺฉุงุฑุจุฑ ูพุงู ุง ูุฑูุงู ุงุฑุณุงู ูโฺฉูุฏ (`@cl.on_message`).
2. ุงฺฏุฑ ูุฑูุงู ุงุณุชุ `handle_command` ุขู ุฑุง ูุฏุฑุช ูโฺฉูุฏ.
3. ุงฺฏุฑ ูพุงู ูุชู/ฺูุฏุฑุณุงููโุง ุงุณุชุ `handle_user_message` ูพุงู ุฑุง ูพุฑุฏุงุฒุดุ ุฏุฑ session ุฐุฎุฑู ู ุจู DB append ูโฺฉูุฏ.
4. ุชุงุฑุฎฺู ูพุงูโูุง (user + assistant) ุจู ุตูุฑุช `api_history` ุชุจุฏู ูโุดูุฏ.
5. `stream_gemini_to_chainlit` ุฏุฑ ฺฉ thread ุชููุฏ ุฑุง ุงุฒ SDK ูโฺฏุฑุฏ ู ุชูฺฉูโูุง ุฑุง ุฏุฑ `asyncio.Queue` ูโฺฏุฐุงุฑุฏุ consumer ุชูฺฉูโูุง ุฑุง ุจุง `msg.stream_token(...)` ุงุณุชุฑู ูโฺฉูุฏ.
6. ูพุงู ููุง assistant ุฏุฑ DB ุฐุฎุฑู ูโุดูุฏ.

---

## โ๏ธ ูุงูโูุง ู ุณุงุฎุชุงุฑ ูพุดููุงุฏ ูพุฑูฺู

```
.
โโ app.py                # ุงูพ ุงุตู (Chainlit) โ ูุงู ุงุฌุฑุง
โโ requirements.txt      # ูุงุจุณุชฺฏโูุง
โโ Dockerfile            # ูููููู ุฏุงฺฉุฑ
โโ docker-compose.yml    # ููููู (App + Mongo ุจุฑุง dev)
โโ .env.example          # ููููู ูุชุบุฑูุง ูุญุท
โโ README.md             # ุงู ูุงู
โโ LICENSE               # (ุงุฎุชุงุฑ)
```

---

## โ ูพุดููุงุฏ ูุญุชู `requirements.txt`

```text
chainlit>=1.3.0
pymongo>=4.3.0
bcrypt>=4.0.0
PyJWT>=2.8.0
python-dotenv>=1.0.0
google-generativeai>=0.12.0
uvicorn>=0.22.0
```

(ุฏุฑ ุตูุฑุช ูุงุฒ ูโุชูุงูู ูุณุฎูโูุง ุฑุง ุฏููโุชุฑ ุง ูููุงู ฺฉูู.)

---

## ๐ณ Docker โ ููููู ู ุฑุงูููุง (ุงุฎุชุงุฑ)

### ููููู `Dockerfile` (ุณุงุฏู โ ููุงุณุจ dev/staging)

```dockerfile
FROM python:3.11-slim
ENV PYTHONUNBUFFERED=1 PIP_NO_CACHE_DIR=1
WORKDIR /app
COPY requirements.txt .
RUN apt-get update && apt-get install -y --no-install-recommends \
    gcc libffi-dev build-essential \
    && pip install --upgrade pip \
    && pip install --no-cache-dir -r requirements.txt \
    && apt-get remove -y build-essential gcc \
    && apt-get autoremove -y \
    && rm -rf /var/lib/apt/lists/*
COPY . /app
RUN useradd -m appuser && chown -R appuser /app
USER appuser
EXPOSE 8000
CMD ["chainlit", "run", "app.py", "--port", "8000"]
```

### ููููู `docker-compose.yml` (ุชูุณุนู: app + mongo)

```yaml
version: '3.8'
services:
  mongo:
    image: mongo:6.0
    restart: unless-stopped
    environment:
      MONGO_INITDB_ROOT_USERNAME: root
      MONGO_INITDB_ROOT_PASSWORD: example
    volumes:
      - mongo_data:/data/db
    ports:
      - "27017:27017"

  app:
    build: .
    environment:
      MONGO_URI: "mongodb://root:example@mongo:27017/?authSource=admin"
      GEMINI_API_KEY: "${GEMINI_API_KEY}"
      JWT_SECRET_KEY: "${JWT_SECRET_KEY}"
    ports:
      - "8000:8000"
    depends_on:
      - mongo
    volumes:
      - ./:/app
    command: ["chainlit", "run", "app.py", "--host", "0.0.0.0", "--port", "8000"]

volumes:
  mongo_data:
```

**ุชูุตูโูุง:**

* ุจุฑุง production ุงุฒ secret manager ุณุฑูุณ ูุฒุจุงู ุงุณุชูุงุฏู ฺฉูุฏ.
* ฺฉุงูุชูุฑ ุฑุง non-root ุงุฌุฑุง ฺฉูุฏ.
* ูพุดุช reverse-proxy (Nginx/Traefik) ูุฑุงุฑ ุฏูุฏ ุชุง TLS termination ู rate-limiting ุงูุฌุงู ุดูุฏ.
* healthcheck ู resource limits ุฑุง ุชูุธู ฺฉูุฏ.

---

## ๐ ุงุฌุฑุง ุฏุฑ Render / Heroku / Railway

* ูุชุบุฑูุง ูุญุท (`MONGO_URI`, `GEMINI_API_KEY`, `JWT_SECRET_KEY`) ุฑุง ุงุฒ ุฏุงุดุจูุฑุฏ ุณุฑูุณ ุชูุธู ฺฉูุฏ.
* ุฏุณุชูุฑ Start ุฑุง ุฑู `chainlit run app.py` ูุฑุงุฑ ุฏูุฏ (ุฏุฑ ุตูุฑุช ูุงุฒ ูพูุฑุช ุฑุง ุงุฒ ูุชุบุฑ ูุญุท ุฎูุงูุฏู ู ุจู `--port` ูพุงุณ ุฏูุฏ).
* ุงฺฏุฑ ุณุฑูุณ ูุญุฏูุฏุช ูพูุฑุช ุฏุงุฑุฏุ Chainlit ุฑุง ุจุง ููุงู ูพูุฑุช ุงุฌุฑุง ฺฉูุฏ.

---

## ๐งช ุฑูุน ุฎุทุง ู ุนุจโุงุจ (Troubleshooting)

* **ุงุชุตุงู MongoDB ูุงูููู**: ุจุฑุฑุณ ฺฉูุฏ `MONGO_URI` ุตุญุญ ุจุงุดุฏ ู ุงฺฏุฑ ุงุฒ Atlas ุงุณุชูุงุฏู ูโฺฉูุฏุ IP allowlist ู credentials ุฑุง ุชูุธู ฺฉุฑุฏู ุจุงุดุฏ.
* **ุฎุทุงูุง JWT / Token**: ููุฏุงุฑ `JWT_SECRET_KEY` ุฑุง ุจุฑุฑุณ ู ุชูฺฉูโูุง ุฑุง ุฏูุจุงุฑู ุจฺฏุฑุฏ.
* **ุฎุทุงูุง Gemini**: ูุทูุฆู ุดูุฏ `GEMINI_API_KEY` ูุนุชุจุฑ ุงุณุช ู quota ฺฉุงู ุฏุงุฑุฏุ ุฎุทุง SDK ุฑุง ุฏุฑ ูุงฺฏ ูฺฏุงู ฺฉูุฏ.
* **ูุดฺฉู event loop**: ูุฑุงุฎูุงูโูุง DB ุฏุงุฎู `asyncio.to_thread` ุงูุฌุงู ุดุฏูโุงูุฏุ ุฏุฑ ุตูุฑุช ุฎุทุง ูุงฺฏ ฺฉุงูู ุฑุง paste ฺฉูุฏ ุชุง ุจุฑุฑุณ ฺฉูู.

---

## ๐ ุงููุช (ูฺฉุงุช ููู)

* `JWT_SECRET_KEY` ุฑุง ูู ู ูุญุงูุธุชโุดุฏู ูฺฏู ุฏุงุฑุฏ.
* ุฑูุฒูุง ููุดู ุจุง `bcrypt` ูุด ูโุดููุฏ.
* ูุจู ุงุฒ ุฐุฎุฑู ูุงูโูุง ูุญุฏูุฏุช ุงูุฏุงุฒู ู ููุน MIME ุฑุง ุจุฑุฑุณ ฺฉูุฏ.
* ุฏุฑ production ุงุฒ HTTPSุ ุชูุธูุงุช CORS ูุญุฏูุฏ ู rate-limiting ุงุณุชูุงุฏู ฺฉูุฏ.

---

## โป๏ธ ุชูุณุนูู ุขุช (Roadmap ูพุดููุงุฏ)

* ุชุบุฑ ุฐุฎุฑูโุณุงุฒ ุชุตุงูุฑ ุจู S3/GCS ู ุฐุฎุฑู ููุท URL ุฏุฑ DB.
* ูุฑู ฺฏุฑุงูฺฉ ุซุจุชโูุงู/ูุฑูุฏ (Chainlit Form ุง ูุฑุงูุชโุงูุฏ ุฌุฏุง) ุจูโุฌุง ูุฑูุงู ูุชู.
* ุงูุฒูุฏู like/dislike ู ุฌูุนโุขูุฑ ุจุงุฒุฎูุฑุฏ ุจุฑุง ูุฑ ูพุงุณุฎ.
* ูุงูู quota/cost-control ุจุฑุงุณุงุณ RPM/RPD ุจุฑุง ูุฏุฑุช ูุฒููู API.
* ุงุถุงูู ฺฉุฑุฏู ูุงฺฏ ู ูุงูุชูุฑูฺฏ (Sentry / Prometheus).

---

## ูุดุงุฑฺฉุช (Contributing)

* Pull requests ุฎูุดโุขูุฏุฏูุ ูุทูุงู ูุจู ุงุฒ ุงุฑุณุงู PR ฺฉ issue ุจุงุฒ ฺฉูุฏ ู ุชุบุฑุงุช ุฑุง ุชูุถุญ ุฏูุฏ.
* ุจุฑุง ุชุณุช ูุญู ุงุฒ `docker-compose` ุงุณุชูุงุฏู ฺฉูุฏ ุชุง Mongo ูุญู ุฏุงุดุชู ุจุงุดุฏ.

---

## ูุฌูุฒ (License)

MIT

--
